(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1403:function(e,t,r){"use strict";r(919)},1404:function(e,t,r){var n=r(19)((function(i){return i[1]}));n.push([e.i,".save-btn[data-v-0e1558e7]{color:#fff;font-size:13px;width:130px;margin-left:12px}",""]),n.locals={},e.exports=n},1651:function(e,t,r){"use strict";r.r(t);r(12),r(11),r(9),r(14),r(13),r(15);var n=r(5),o=r(16),c=(r(0),r(1),r(2),r(3),r(48),r(27),r(36),r(41),r(32),r(35),r(61),r(29),r(24));function l(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var d={name:"CreateWedsite",components:{Editor:function(){return Promise.all([r.e(0),r.e(1),r.e(6),r.e(8),r.e(7)]).then(r.bind(null,1604))},SegmentDialog:function(){return r.e(85).then(r.bind(null,1660))}},layout:"theme",asyncData:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r,data,n,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$apis.themes.get(e.route.params.id);case 2:return r=t.sent,data=r.data,n=e.route.query,o=n.groom,c=n.bride,t.abrupt("return",{theme:e.$utils.editor.prefillData(data,{groom:o,bride:c}),dialogSegment:"saved"===e.route.query.action});case 6:case"end":return t.stop()}}),t)})))()},data:function(){return{loading:!1}},head:function(){return{title:this.theme.name,bodyAttrs:{class:["no-fb-chat"]}}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(c.b)("",["userInfo"])),mounted:function(){this.$isMobile()&&this.$nuxt.error({statusCode:423,message:"Không chỉnh sửa được trên giao diện này"})},methods:{saveWedsite:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.userInfo){t.next=6;break}return r=e.$refs.editor.getCurrentState(),localStorage.setItem("editor_state",JSON.stringify(r)),t.next=5,e.$router.replace(e.localePath({name:"auth-signin",query:{cbPath:"".concat(e.$route.fullPath).concat(e.$lodash.isEmpty(e.$route.query)?"?":"&","action=saved")}}));case 5:return t.abrupt("return");case 6:e.dialogSegment=!0;case 7:case"end":return t.stop()}}),t)})))()},createWedsite:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,title,o,c,l,d,f,m,html,h,v,y,audio,x,O,w,$,data,_,k,j,P,S,D;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.segment,title=e.title,o=e.thumbnail,t.loading=!0,c="saved"===t.$route.query.action?JSON.parse(localStorage.getItem("editor_state")):t.$refs.editor.getCurrentState(),l=t.$route.query,d=l.groom,f=l.bride,html=(m=c).html,h=m.styles,v=m.assets,y=m.palettes,audio=m.audio,x=m.activePalette,O=m.activeFonts,w=m.activeDecoration,r.next=7,t.$apis.wedsites.create({segment:n,title:title,thumbnail:o,html:html,styles:h,assets:v,palettes:y,audio_id:(null==audio?void 0:audio.id)||null,decorations:t.theme.decorations,active_palette:x,active_fonts:O,active_decoration:w,status:"premium"===t.theme.package&&null===t.userInfo.service?"unpublished":"published",theme_id:t.$route.params.id,groom_name:d,bride_name:f});case 7:if($=r.sent,data=$.data,_=$.status,t.loading=!1,"success"===_){r.next=14;break}return t.$notifier.showMessage({content:"Lưu trang thất bại. Vui lòng thử lại sau",color:"error"}),r.abrupt("return");case 14:if(t.theme.category!==t.$const.THEME_CATEGORY.CHARITY){r.next=18;break}return k=t.$refs.editor.getFundInfo(),j=k.promoter,P=k.target,S=k.contact,D=k.endDate,r.next=18,t.$apis.wedsites.updateFundInfo(data.id,{target_amount:P,organization:j,url:S,end_at:D});case 18:if("premium"!==t.theme.package||null!==t.userInfo.service){r.next=23;break}return r.next=21,t.$router.replace(t.localePath({name:"wedsites-id",params:{id:data.id},query:{upgradeDialog:!0}}));case 21:r.next=30;break;case 23:if(t.theme.category!==t.$const.THEME_CATEGORY.WEDDING){r.next=28;break}return r.next=26,t.$router.replace(t.localePath({name:"wedsites-id",params:{id:data.id},query:{dialogTag:!0}}));case 26:r.next=30;break;case 28:return r.next=30,t.$router.replace(t.localePath({name:"wedsites-id",params:{id:data.id},query:{share:!0}}));case 30:case"end":return r.stop()}}),r)})))()},closeDialog:function(){this.upgradeDialogVisible=!1}}},f=(r(1403),r(21)),m=r(33),h=r.n(m),v=r(269),component=Object(f.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("client-only",[r("editor",{ref:"editor",attrs:{debug:""+e.$route.query.debug=="true",theme:e.theme},on:{exit:function(t){return e.$router.back()}},scopedSlots:e._u([{key:"action",fn:function(){return[r("v-btn",{staticClass:"save-btn",attrs:{outlined:"",color:"#313990"},on:{click:e.saveWedsite}},[e._v(" Lưu Trang ")]),e._v(" "),r("SegmentDialog",{attrs:{loading:e.loading},on:{save:e.createWedsite},model:{value:e.dialogSegment,callback:function(t){e.dialogSegment=t},expression:"dialogSegment"}})]},proxy:!0}])})],1)}),[],!1,null,"0e1558e7",null);t.default=component.exports;h()(component,{VBtn:v.a})},919:function(e,t,r){var content=r(1404);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(20).default)("120f7092",content,!0,{sourceMap:!1})}}]);